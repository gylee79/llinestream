{
  "entities": {
    "User": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "User",
      "type": "object",
      "description": "Represents a user of the LlineStream application.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the User entity."
        },
        "email": {
          "type": "string",
          "description": "User's email address.",
          "format": "email"
        },
        "contact": {
          "type": "string",
          "description": "User's contact phone number."
        },
        "birthDate": {
          "type": "string",
          "description": "User's birth date.",
          "format": "date-time"
        },
        "joinDate": {
          "type": "string",
          "description": "The date the user joined the application.",
          "format": "date-time"
        },
        "activeSubscriptionIds": {
          "type": "array",
          "description": "References to active Subscriptions. (Relationship: User 1:N Subscription)",
          "items": {
            "type": "string"
          }
        }
      },
      "required": [
        "id",
        "email",
        "contact",
        "birthDate",
        "joinDate"
      ]
    },
    "Field": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Field",
      "type": "object",
      "description": "Represents a top-level category for content (e.g., Education, Movies).",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Field entity."
        },
        "name": {
          "type": "string",
          "description": "Name of the field (e.g., Education)."
        },
        "description": {
          "type": "string",
          "description": "Description of the field."
        }
      },
      "required": [
        "id",
        "name",
        "description"
      ]
    },
    "Classification": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Classification",
      "type": "object",
      "description": "Represents a genre or category that can be subscribed to (e.g., Coding, Action).",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Classification entity."
        },
        "fieldId": {
          "type": "string",
          "description": "Reference to Field. (Relationship: Field 1:N Classification)"
        },
        "name": {
          "type": "string",
          "description": "Name of the classification (e.g., Coding)."
        },
        "description": {
          "type": "string",
          "description": "Description of the classification."
        },
        "monthlySubscriptionFee": {
          "type": "number",
          "description": "Monthly subscription fee for this classification."
        },
        "dailySubscriptionFee": {
          "type": "number",
          "description": "Daily subscription fee for this classification."
        }
      },
      "required": [
        "id",
        "fieldId",
        "name",
        "description",
        "monthlySubscriptionFee",
        "dailySubscriptionFee"
      ]
    },
    "Course": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Course",
      "type": "object",
      "description": "Represents a video series within a classification (e.g., React Master Class).",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Course entity."
        },
        "classificationId": {
          "type": "string",
          "description": "Reference to Classification. (Relationship: Classification 1:N Course)"
        },
        "name": {
          "type": "string",
          "description": "Name of the course (e.g., React Master Class)."
        },
        "description": {
          "type": "string",
          "description": "Description of the course."
        },
        "thumbnailUrl": {
          "type": "string",
          "description": "URL of the course thumbnail image.",
          "format": "uri"
        }
      },
      "required": [
        "id",
        "classificationId",
        "name",
        "description",
        "thumbnailUrl"
      ]
    },
    "Episode": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Episode",
      "type": "object",
      "description": "Represents an individual video within a course.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Episode entity."
        },
        "courseId": {
          "type": "string",
          "description": "Reference to Course. (Relationship: Course 1:N Episode)"
        },
        "title": {
          "type": "string",
          "description": "Title of the episode."
        },
        "description": {
          "type": "string",
          "description": "Description of the episode."
        },
        "videoUrl": {
          "type": "string",
          "description": "URL of the video file.",
          "format": "uri"
        },
        "duration": {
          "type": "number",
          "description": "Duration of the episode in seconds."
        },
        "isFree": {
          "type": "boolean",
          "description": "Indicates whether the episode is free to watch."
        }
      },
      "required": [
        "id",
        "courseId",
        "title",
        "description",
        "videoUrl",
        "duration",
        "isFree"
      ]
    },
    "Policy": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Policy",
      "type": "object",
      "description": "Represents the legal policies of the application (e.g., Terms of Service, Privacy Policy).",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Policy entity."
        },
        "type": {
          "type": "string",
          "description": "Type of policy (e.g., termsOfService, privacyPolicy, refundPolicy)."
        },
        "content": {
          "type": "string",
          "description": "The text content of the policy."
        },
        "lastUpdated": {
          "type": "string",
          "description": "Date and time the policy was last updated.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "type",
        "content",
        "lastUpdated"
      ]
    },
    "Subscription": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Subscription",
      "type": "object",
      "description": "Represents a user's subscription to a specific classification.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Subscription entity."
        },
        "userId": {
          "type": "string",
          "description": "Reference to User. (Relationship: User 1:N Subscription)"
        },
        "classificationId": {
          "type": "string",
          "description": "Reference to Classification. (Relationship: Classification 1:N Subscription)"
        },
        "startDate": {
          "type": "string",
          "description": "Start date of the subscription.",
          "format": "date-time"
        },
        "endDate": {
          "type": "string",
          "description": "End date of the subscription.",
          "format": "date-time"
        },
        "paymentTransactionId": {
          "type": "string",
          "description": "Reference to payment transaction id"
        }
      },
      "required": [
        "id",
        "userId",
        "classificationId",
        "startDate",
        "endDate"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/users/{userId}",
        "definition": {
          "entityName": "User",
          "schema": {
            "$ref": "#/backend/entities/User"
          },
          "description": "Stores user profile information. Includes the 'activeSubscriptionIds' array for quick access to active subscriptions. This enables direct access without requiring complex queries. Authorization is based on path ownership (`request.auth.uid == userId`).",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user."
            }
          ]
        }
      },
      {
        "path": "/fields/{fieldId}",
        "definition": {
          "entityName": "Field",
          "schema": {
            "$ref": "#/backend/entities/Field"
          },
          "description": "Stores top-level content categories (e.g., Education, Movies). Authorization: Open read access, restricted write access to admins.",
          "params": [
            {
              "name": "fieldId",
              "description": "The unique identifier for the field."
            }
          ]
        }
      },
      {
        "path": "/classifications/{classificationId}",
        "definition": {
          "entityName": "Classification",
          "schema": {
            "$ref": "#/backend/entities/Classification"
          },
          "description": "Stores content classifications or genres (e.g., Coding, Action). Authorization: Open read access, restricted write access to admins.",
          "params": [
            {
              "name": "classificationId",
              "description": "The unique identifier for the classification."
            }
          ]
        }
      },
      {
        "path": "/courses/{courseId}",
        "definition": {
          "entityName": "Course",
          "schema": {
            "$ref": "#/backend/entities/Course"
          },
          "description": "Stores video series within a classification (e.g., React Master Class). Authorization: Open read access, restricted write access to admins.",
          "params": [
            {
              "name": "courseId",
              "description": "The unique identifier for the course."
            }
          ]
        }
      },
      {
        "path": "/episodes/{episodeId}",
        "definition": {
          "entityName": "Episode",
          "schema": {
            "$ref": "#/backend/entities/Episode"
          },
          "description": "Stores individual videos within a course. Authorization: Open read access, restricted write access to admins.  Access to non-free episodes requires a valid subscription, which should be checked in security rules.",
          "params": [
            {
              "name": "episodeId",
              "description": "The unique identifier for the episode."
            }
          ]
        }
      },
      {
        "path": "/policies/{policyId}",
        "definition": {
          "entityName": "Policy",
          "schema": {
            "$ref": "#/backend/entities/Policy"
          },
          "description": "Stores legal policies (e.g., Terms of Service, Privacy Policy). Authorization: Open read access, restricted write access to admins.",
          "params": [
            {
              "name": "policyId",
              "description": "The unique identifier for the policy."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/subscriptions/{subscriptionId}",
        "definition": {
          "entityName": "Subscription",
          "schema": {
            "$ref": "#/backend/entities/Subscription"
          },
          "description": "Stores user subscriptions. Authorization: Only the user can read/write their own subscriptions (`request.auth.uid == userId`).",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user."
            },
            {
              "name": "subscriptionId",
              "description": "The unique identifier for the subscription."
            }
          ]
        }
      },
      {
        "path": "/roles_admin/{userId}",
        "definition": {
          "entityName": "adminRole",
          "schema": {
            "$ref": "#/backend/entities/User"
          },
          "description": "Collection to store admin users. Document existence indicates admin role.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore structure is designed to support LlineStream's video streaming and subscription model while adhering to the principles of Authorization Independence, Structural Segregation, Access Modeling, and Data Clarity. Each top-level collection represents a distinct entity type, simplifying security rules and data management.\n\n*   **Authorization Independence:** Denormalization is used extensively to avoid `get()` calls in security rules. For instance, subscription information crucial for content access control is embedded within User documents and potentially duplicated in denormalized copies within content documents if required. Membership Maps (e.g., in hypothetical collaborative playlists) would also denormalize user roles.\n\n*   **Structural Segregation:**  The structure separates different types of data into distinct collections based on their access control needs. User-specific data resides under `/users/{userId}`, while global content like `/fields`, `/classifications`, `/courses`, and `/episodes` are placed in separate top-level collections.  This segregation is critical for QAPs because it allows secure listing of content (e.g., listing all Courses) without exposing private user data.\n\n*   **Access Modeling:** Path-based ownership is used for user-specific data (`/users/{userId}/subscriptions`). Global roles (admin) would be managed through a dedicated collection (e.g., `/roles_admin/{userId}`). The Subscription documents directly under users enable easy querying of a user's active subscriptions.\n\n*   **Data Clarity and Predictability:** Explicit state modeling using a `status` field (if needed, e.g., for courses) is recommended. Semantic naming conventions are used for all paths and parameters.\n\nThis structure facilitates robust security rules because access control can be based directly on the path and the contents of the document being accessed, without needing to fetch related documents. It also supports the required QAPs by enabling secure listing of content and efficient querying of user-specific data."
  }
}