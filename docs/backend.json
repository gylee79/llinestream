{
  "entities": {
    "User": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "User",
      "type": "object",
      "description": "Represents a user of the LlineStream application.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the User entity."
        },
        "email": {
          "type": "string",
          "description": "User's email address.",
          "format": "email"
        },
        "phoneNumber": {
          "type": "string",
          "description": "User's contact phone number."
        },
        "birthDate": {
          "type": "string",
          "description": "User's birth date.",
          "format": "date-time"
        },
        "activeSubscriptionIds": {
          "type": "array",
          "description": "References to active Subscriptions. (Relationship: User 1:N Subscription)",
          "items": {
            "type": "string"
          }
        },
        "joinDate": {
          "type": "string",
          "description": "The date the user joined the application.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "email",
        "joinDate"
      ]
    },
    "Field": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Field",
      "type": "object",
      "description": "Represents a top-level category in the LlineStream application (e.g., Education, Movies).",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Field entity."
        },
        "name": {
          "type": "string",
          "description": "Name of the field (e.g., Education)."
        },
        "description": {
          "type": "string",
          "description": "Description of the field."
        }
      },
      "required": [
        "id",
        "name"
      ]
    },
    "Classification": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Classification",
      "type": "object",
      "description": "Represents a subscription category/genre (e.g., Coding, Action) within a Field.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Classification entity."
        },
        "fieldId": {
          "type": "string",
          "description": "Reference to Field. (Relationship: Field 1:N Classification)"
        },
        "name": {
          "type": "string",
          "description": "Name of the classification (e.g., Coding)."
        },
        "description": {
          "type": "string",
          "description": "Description of the classification."
        },
        "monthlySubscriptionPrice": {
          "type": "number",
          "description": "Monthly subscription price for this classification."
        },
        "dailySubscriptionPrice": {
          "type": "number",
          "description": "Daily subscription price for this classification."
        }
      },
      "required": [
        "id",
        "fieldId",
        "name"
      ]
    },
    "Course": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Course",
      "type": "object",
      "description": "Represents a video series within a Classification (e.g., React Master Class).",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Course entity."
        },
        "classificationId": {
          "type": "string",
          "description": "Reference to Classification. (Relationship: Classification 1:N Course)"
        },
        "name": {
          "type": "string",
          "description": "Name of the course (e.g., React Master Class)."
        },
        "description": {
          "type": "string",
          "description": "Description of the course."
        },
        "thumbnailUrl": {
          "type": "string",
          "description": "URL of the course thumbnail image.",
          "format": "uri"
        }
      },
      "required": [
        "id",
        "classificationId",
        "name"
      ]
    },
    "Episode": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Episode",
      "type": "object",
      "description": "Represents an individual video within a Course.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Episode entity."
        },
        "courseId": {
          "type": "string",
          "description": "Reference to Course. (Relationship: Course 1:N Episode)"
        },
        "title": {
          "type": "string",
          "description": "Title of the episode."
        },
        "description": {
          "type": "string",
          "description": "Description of the episode."
        },
        "videoUrl": {
          "type": "string",
          "description": "URL of the video file.",
          "format": "uri"
        },
        "duration": {
          "type": "number",
          "description": "Duration of the episode in seconds."
        },
        "isFree": {
          "type": "boolean",
          "description": "Indicates if the episode is free to watch."
        }
      },
      "required": [
        "id",
        "courseId",
        "title",
        "videoUrl",
        "duration"
      ]
    },
    "Subscription": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Subscription",
      "type": "object",
      "description": "Represents a user's subscription to a specific Classification.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Subscription entity."
        },
        "userId": {
          "type": "string",
          "description": "Reference to User. (Relationship: User 1:N Subscription)"
        },
        "classificationId": {
          "type": "string",
          "description": "Reference to Classification. (Relationship: Classification 1:N Subscription)"
        },
        "startDate": {
          "type": "string",
          "description": "Start date of the subscription.",
          "format": "date-time"
        },
        "endDate": {
          "type": "string",
          "description": "End date of the subscription.",
          "format": "date-time"
        },
        "price": {
          "type": "number",
          "description": "Price paid for the subscription."
        }
      },
      "required": [
        "id",
        "userId",
        "classificationId",
        "startDate",
        "endDate",
        "price"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/users/{userId}",
        "definition": {
          "entityName": "User",
          "schema": {
            "$ref": "#/backend/entities/User"
          },
          "description": "Stores user profiles. Uses path-based ownership for private user data.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier of the user."
            }
          ]
        }
      },
      {
        "path": "/fields/{fieldId}",
        "definition": {
          "entityName": "Field",
          "schema": {
            "$ref": "#/backend/entities/Field"
          },
          "description": "Stores top-level categories (e.g., Education, Movies).",
          "params": [
            {
              "name": "fieldId",
              "description": "The unique identifier of the field."
            }
          ]
        }
      },
      {
        "path": "/classifications/{classificationId}",
        "definition": {
          "entityName": "Classification",
          "schema": {
            "$ref": "#/backend/entities/Classification"
          },
          "description": "Stores subscription categories/genres within a Field.",
          "params": [
            {
              "name": "classificationId",
              "description": "The unique identifier of the classification."
            }
          ]
        }
      },
      {
        "path": "/courses/{courseId}",
        "definition": {
          "entityName": "Course",
          "schema": {
            "$ref": "#/backend/entities/Course"
          },
          "description": "Stores video series within a Classification.",
          "params": [
            {
              "name": "courseId",
              "description": "The unique identifier of the course."
            }
          ]
        }
      },
      {
        "path": "/courses/{courseId}/episodes/{episodeId}",
        "definition": {
          "entityName": "Episode",
          "schema": {
            "$ref": "#/backend/entities/Episode"
          },
          "description": "Stores individual videos within a Course.",
          "params": [
            {
              "name": "courseId",
              "description": "The unique identifier of the course."
            },
            {
              "name": "episodeId",
              "description": "The unique identifier of the episode."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/subscriptions/{subscriptionId}",
        "definition": {
          "entityName": "Subscription",
          "schema": {
            "$ref": "#/backend/entities/Subscription"
          },
          "description": "Stores user subscriptions to specific Classifications. Uses path-based ownership.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier of the user."
            },
            {
              "name": "subscriptionId",
              "description": "The unique identifier of the subscription."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore structure is designed to support LlineStream's video streaming service, focusing on clear authorization and efficient data retrieval. It leverages path-based ownership for user-specific data (subscriptions) and a membership map approach where collaborative access is required. The design ensures authorization independence by denormalizing necessary authorization data, eliminating the need for `get()` calls in security rules and maintaining atomic operations. Segregation is implemented to maintain homogeneous security postures for collections.\n\n*   **Authorization Independence**: The structure avoids hierarchical authorization dependencies by using path-based ownership for user-specific data (subscriptions) and membership maps where collaborative access is required. This denormalization allows security rules to be written without `get()` calls, crucial for atomic operations.\n*   **QAPs (Rules are not Filters)**: The design supports secure `list` operations by segregating data with different access requirements into separate collections. For instance, user-specific data is stored under `/users/{userId}`, allowing simple rules to control access based on the authenticated user's ID.\n*   **DBAC (Database-Based Access Control)**: User roles or group memberships are stored directly within database documents, avoiding reliance on custom claims. This approach simplifies the security rules and makes them more transparent.\n*   **Data Integrity**: The schema enforces invariants like ownership and timestamps through strict naming conventions and explicit field definitions. For instance, `userId` always represents the owner of a subscription."
  }
}